framework:
    messenger:
        failure_transport: failed_messages
        default_bus: none.bus
        buses:
            none.bus:
                default_middleware: allow_no_handlers
            command.bus:
                middleware:
                    - doctrine_ping_connection
                    - doctrine_close_connection
                    - doctrine_transaction
            query.bus:
                default_middleware: allow_no_handlers
                middleware:
                    - validation
            event.bus:
                default_middleware: allow_no_handlers
                middleware:
                    - validation
        transports:
            commands:
                dsn: '%env(MESSENGER_TRANSPORT_BASE_DSN)%/commands'
            sync_commands:
                dsn: 'sync://'
            events:
                dsn: '%env(MESSENGER_TRANSPORT_BASE_DSN)%/events'
            query:
                dsn: 'sync://'
            failed_messages:
                dsn: '%env(MESSENGER_TRANSPORT_BASE_DSN)%/failed-messages'
        routing:
            # Consider Following an Author is a sync command.
            # With a proper UX, almost all the commands should
            # be run asynchronously.
            Cheeper\Chapter6\Application\Command\Author\Follow: sync_commands

            # Domain Events are sent to asynchronous
            # transport to be processed later.
            Cheeper\DomainModel\Follow\AuthorFollowed: events

            # Projections are like Commands, they need
            # to be calculated asynchronously for not impacting
            # the performance
            Cheeper\Chapter6\Application\Projector\Author\CountFollowers: commands

            # Queries are executed synchronously
            # in the same request that data is requested.
            Cheeper\Chapter5\Application\Query\Query: query